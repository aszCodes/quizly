<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Leaderboard - <%= title %></title>
		<link rel="stylesheet" href="/style.css" />
		<style>
			* {
				box-sizing: border-box;
			}
			body {
				overflow-x: hidden;
			}
			h1 {
				font-size: 1.8rem;
			}
			.table-wrapper {
				width: 100%;
				overflow-x: auto;
				-webkit-overflow-scrolling: touch;
				cursor: default;
			}
			table {
				width: 100%;
				min-width: 500px;
				border-collapse: collapse;
				background: white;
				border-radius: 8px;
				overflow: hidden;
				user-select: none;
			}
			thead {
				background: #715a5a;
				color: white;
			}
			th,
			td {
				padding: 12px 8px;
				text-align: left;
				font-size: 0.9rem;
			}
			th {
				font-weight: bold;
			}
			tbody tr {
				border-bottom: 1px solid #e0e0e0;
			}
			tbody tr:last-child {
				border-bottom: none;
			}
			tbody tr:hover {
				background: #f5f5f5;
			}
			.rank {
				font-weight: bold;
				color: #715a5a;
				font-size: 1.2rem;
				width: 50px;
				text-align: center;
			}
			.correct {
				color: #4caf50;
				font-weight: bold;
			}
			.incorrect {
				color: #d32f2f;
				font-weight: bold;
			}
			.loading,
			.empty {
				text-align: center;
				padding: 40px 20px;
				color: #715a5a;
			}
			button {
				margin-top: 30px;
			}

			@media (max-width: 600px) {
				main {
					padding: 20px;
				}
				h1 {
					font-size: 1.5rem;
				}
				th,
				td {
					padding: 10px 6px;
					font-size: 0.85rem;
				}
				.rank {
					font-size: 1rem;
				}
			}
		</style>
	</head>
	<body>
		<main>
			<h1>üèÜ Leaderboard</h1>

			<div class="loading" id="loading">Loading...</div>
			<div class="empty" id="empty" style="display: none">
				No submissions yet. Be the first!
			</div>

			<div class="table-wrapper" id="table" style="display: none">
				<table>
					<thead>
						<tr>
							<th>Rank</th>
							<th>Student</th>
							<th>Answer</th>
							<th>Score</th>
							<th>Time</th>
						</tr>
					</thead>
					<tbody id="tbody"></tbody>
				</table>
			</div>

			<button onclick="location.href='/'">Home</button>
		</main>

		<script>
			async function load() {
				try {
					const res = await fetch("/api/leaderboard");
					if (!res.ok) throw new Error("Failed");
					const data = await res.json();

					document.getElementById("loading").style.display = "none";

					if (!data.length) {
						document.getElementById("empty").style.display =
							"block";
						return;
					}

					document.getElementById("table").style.display = "block";

					data.sort((a, b) =>
						b.score !== a.score
							? b.score - a.score
							: a.duration - b.duration
					);

					const tbody = document.getElementById("tbody");
					data.forEach((e, i) => {
						const medal =
							i === 0
								? "ü•á"
								: i === 1
								? "ü•à"
								: i === 2
								? "ü•â"
								: i + 1;
						const scoreClass =
							e.score > 0 ? "correct" : "incorrect";

						tbody.innerHTML += `
							<tr>
								<td class="rank">${medal}</td>
								<td><strong>${escape(e.student_name)}</strong></td>
								<td>${escape(e.student_answer)}</td>
								<td class="${scoreClass}">${e.score}</td>
								<td>${e.duration}s</td>
							</tr>
						`;
					});
				} catch (err) {
					document.getElementById("loading").textContent =
						"Failed to load";
				}
			}

			function escape(text) {
				const div = document.createElement("div");
				div.textContent = text;
				return div.innerHTML;
			}

			load();
		</script>
	</body>
</html>
